"use strict";(self["webpackChunklite"]=self["webpackChunklite"]||[]).push([[6410],{6410:function(e,t,s){s.r(t),s.d(t,{default:function(){return A}});var i=s(1032),n=function(){var e=this,t=e._self._c;return t("lay-header",{attrs:{showBack:!0,tBarColor:"#FFFFFF",txtRight:e.$t("common.done"),txtTitle:e.$t("collection.pics.title"),onRight:e.onClickActionComp}},[t(i.A,{staticClass:"lay-body",attrs:{column:""}},[t("span",{staticClass:"txt-cnt pt-1 pb-4 px-5"},[e._v(e._s(e.$t("collection.pics.desc",{count:e.selectItems.length,title:e.title})))]),t(i.A,{staticClass:"flex-grow-0 pb-5",attrs:{wrap:"",row:""}},e._l(e.items,(function(s,i){return t("c-pic",{key:i,attrs:{editMode:!0,src:s.thumbName+`?${e.filterVer}`,isVideo:"VIDEO"==s.fileType,duration:s.videoTime,select:e.selectItems.indexOf(s.mediaId)>-1?e.selectItems.indexOf(s.mediaId)+1:null,isLike:"Y"==s.likeYn,isFilter:"1"==s.filterd,isMemo:s.memo.title||s.memo.memo,onClick:()=>e.onClickActionSelect(s.mediaId)}})})),1)],1)],1)},l=[],r=(s(4114),s(3689)),c=s(3776),o=s(8414),a=s.n(o),h=s(7488),d=s(3171);const m={request:async e=>{let t={isSuccess:!1,errorMsg:"",data:null},s=`   \n            INSERT INTO \n                TB_COLLECTION\n            VALUES (\n                NULL,\n                '${(0,d.cA)()}',\n                '${e}',\n                0,\n                0,\n                strftime('%Y%m%d%H%M%S', 'now', 'localtime'),\n                0\n            ) \n        `;try{var i=await new Promise(((e,t)=>{const i=`API_GETINFO_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"runQuery",query:s}),i),window[`${i}`]=s=>{try{s?e(s):t()}catch(n){t(n)}delete window[`${i}`]}}));if(JSON.parse(i).result)return new Promise(((e,s)=>{let i="\n                        SELECT \n                            collectionId \n                        FROM \n                            TB_COLLECTION \n                        WHERE \n                            deleted = 0 \n                        ORDER BY \n                            collectionId DESC \n                        LIMIT 1\n                    ";const n=`API_GETID_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"selectQuery",query:i}),n),window[`${n}`]=i=>{try{if(i){const s=JSON.parse(i);t.isSuccess=s.result,t.errorMsg=s.error,t.data=s.data&&s.data.length>0?s.data[0]:s.data,e(t)}else s()}catch(l){s(l)}delete window[`${n}`]}}));throw"error"}catch(n){throw n}}};var u=m;const I={request:async(e,t)=>{let s={isSuccess:!1,errorMsg:"",data:null},i="";t.forEach((t=>{i&&(i+=" UNION "),i+=`\n                SELECT\n                    NULL,\n                    ${e},\n                    ${t},\n                    0,\n                    strftime('%Y%m%d%H%M%S', 'now', 'localtime'),\n                    0\n            `}));let n=`   \n            INSERT INTO \n                TB_COLLECTION_MEDIA\n            ${i}\n        `;return new Promise(((e,t)=>{const i=`API_GETINFO_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"runQuery",query:n}),i),window[`${i}`]=n=>{try{if(n){const t=JSON.parse(n);s.isSuccess=t.result,s.errorMsg=t.error,s.data=t.data,e(s)}else t()}catch(l){t(l)}delete window[`${i}`]}}))}};var E=I,g=s(3548),C={props:["title","seq"],data(){return{isGetingItems:!1,isEditMode:!1,selectItems:[],items:[],pageNo:1,allCount:0,gallInfo:null}},computed:{},watch:{isEditMode(){this.selectItems.splice(0,this.selectItems.length)}},created(){window.addEventListener("scroll",this.handleScroll)},mounted(){this.seq?this.getData():this.getItems()},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{async getData(){if(this.isGetingItems)return;this.isGetingItems=!0;let e=await g.A.request(this.seq);this.isGetingItems=!1,e.isSuccess?(this.title=1==e.data.favorite?this.$t("collection.like"):e.data.collectionName,this.getItems()):(this.showToast(this.$t("error.error"),!1,!1),this.$router.go(-1))},async getItems(e=1){this.isGetingItems||(this.isGetingItems=!0,await c.A.request(e,20,null,this.seq).then((t=>{this.isGetingItems=!1,this.pageNo=e,1==e&&this.items.splice(0,this.items.length),this.allCount=t.allCount,this.items.push(...t.list),this.items.forEach((e=>{e.memo=JSON.parse(e.memo.replace(/\n/g,"\\n"))})),setTimeout((()=>{var e=document.children[0];this.checkNext(e)}),300)})).catch((()=>{this.isGetingItems=!1})))},handleScroll(e){let t=e.target.children[0];this.checkNext(t)},checkNext(e){this.items.length<this.allCount&&e&&e.scrollHeight-e.clientHeight-80<e.scrollTop&&this.getItems(this.pageNo+1)},async insertCollection(e){this.selectItems&&this.selectItems.length?await E.request(e,this.selectItems).then((e=>{this.isGetingItems=!1,e.isSuccess?(this.showToast(this.$t("error.save-comp"),!0,!1),this.$router.go(this.seq?-1:-2)):this.showToast(this.$t("error.error"),!1,!1)})).catch((()=>{this.isGetingItems=!1})):(this.isGetingItems=!1,this.showToast(this.$t("error.save-comp"),!0,!1),this.$router.go(this.seq?-1:-2))},async onClickActionComp(){this.isGetingItems||(this.isGetingItems=!0,this.seq?this.insertCollection(this.seq):await u.request(this.title).then((e=>{e.isSuccess?this.insertCollection(e.data.collectionId):this.isGetingItems=!1})).catch((()=>{this.isGetingItems=!1})))},onClickActionSelect(e){this.selectItems.indexOf(e)>-1?this.selectItems.splice(this.selectItems.indexOf(e),1):this.selectItems.push(e)}},components:{CPic:r.A}},N=C,w=s(1656),O=(0,w.A)(N,n,l,!1,null,"1b91ab3e",null),A=O.exports},3548:function(e,t,s){var i=s(8414),n=s.n(i),l=s(7488);const r={request:async e=>{let t={isSuccess:!1,errorMsg:"",data:null},s=`   \n            SELECT \n                *\n            FROM \n                TB_COLLECTION \n            WHERE\n                collectionId = ${e}\n        `;return new Promise(((e,i)=>{const r=`API_GETINFO_CALLBACK_${n()().replace(/-/gi,"")}`;l.A.sqlite(JSON.stringify({cmd:"selectQuery",query:s}),r),window[`${r}`]=s=>{try{if(s){const i=JSON.parse(s);t.isSuccess=i.result,t.errorMsg=i.error,t.data=i.data&&i.data.length>0?i.data[0]:null,e(t)}else i()}catch(n){i(n)}delete window[`${r}`]}}))}};t.A=r},3776:function(e,t,s){var i=s(8414),n=s.n(i),l=s(7488),r=s(7334);const c={request:async(e=1,t=20,s,i)=>{let c={isSuccess:!1,errorMsg:"",list:null,allCount:0},o="\n            SELECT \n                COUNT(*) AS cnt \n            FROM \n                TB_MEDIA \n            WHERE \n                deleted = 0\n        ",a="\n            SELECT \n               *\n            FROM \n               (\n                    SELECT \n                        m.*,\n                        CASE WHEN(COUNT(cm.collectionMediaId) > 0) THEN 'Y' ELSE 'N' END as likeYn\n                    FROM \n                        TB_MEDIA m\n                    LEFT JOIN\n                        TB_COLLECTION_MEDIA cm\n                    ON\n                        m.mediaId = cm.mediaId \n                        AND cm.collectionId = 1 \n                        AND cm.deleted = 0\n                    GROUP BY\n                        m.mediaId\n                )\n            WHERE \n                deleted = 0\n        ";if(s&&s.length&&s.forEach((e=>{a+=` AND ${e.key} = '${e.val}' `,o+=` AND ${e.key} = '${e.val}' `})),i){let e=`\n                AND mediaId NOT IN (\n                    SELECT \n                        mediaId\n                    FROM\n                        TB_COLLECTION_MEDIA\n                    WHERE \n                        deleted = 0\n                    AND \n                        collectionId = ${i}\n                )\n            `;a+=e,o+=e}a+=`   \n            ORDER BY \n                createDate DESC\n            LIMIT ${t} OFFSET ${t*(e-1)}\n        `;try{c.allCount=await r.A.request(o,"cnt")}catch(h){return Promise.reject(h)}return new Promise(((e,t)=>{const s=`API_GETLIST_CALLBACK_${n()().replace(/-/gi,"")}`;l.A.sqlite(JSON.stringify({cmd:"selectQuery",query:a}),s),window[`${s}`]=i=>{try{if(i){const t=JSON.parse(i);c.isSuccess=t.result,c.errorMsg=t.error,c.list=t.data,e(c)}else t()}catch(h){t(h)}delete window[`${s}`]}}))}};t.A=c}}]);
//# sourceMappingURL=6410.6b1fbc6e.js.map